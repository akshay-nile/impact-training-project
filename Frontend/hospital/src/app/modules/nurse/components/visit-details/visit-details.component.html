<mat-tab-group>
    <mat-tab label="Appointment Details">
        <mat-card class="example-card">
            

            <form autofocus="off" [formGroup]="appointmentForm">
                <div class="mb-4">
                    <label for="meetingTitle" class="form-label">Meeting Title</label>
                    <input type="text" formControlName="meetingTitle" class="form-control" id="meetingTitle" [(ngModel)]="appointment.meetingTitle">
                    <div *ngIf="appointmentForm.controls['meetingTitle'].touched && appointmentForm.controls['meetingTitle'].invalid">
                        <small *ngIf="appointmentForm.controls['meetingTitle'].errors?.['required']" class="text-danger">Meeting Title
                            cannot be blank</small>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="description" class="form-label">Description</label>
                    <textarea type="text" formControlName="description" class="form-control" id="description" [(ngModel)]="appointment.description"></textarea>
                    <div *ngIf="appointmentForm.controls['description'].touched && appointmentForm.controls['description'].invalid">
                        <small *ngIf="appointmentForm.controls['description'].errors?.['required']" class="text-danger">Description cannot
                            be blank</small>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col col-md-8">
                        <label for="physician" class="form-label">Physician Name</label>
                        <select formControlName="physician" class="form-control"
                            (change)="getAvailabilityWindows(); showPhysicianId();" [(ngModel)]="appointment.physician">
                            <option value=''>Select Physician</option>
                            <option *ngFor="let ph of physicians" [value]="ph.email">{{ph.name}}</option>
                        </select>
                        <small *ngIf="appointmentForm.controls['physician'].touched && appointmentForm.controls['physician'].invalid"
                            class="text-danger">Physician cannot be empty</small>
                    </div>
                    <div class="col col-md-4">
                        <label for="employeeId" class="form-label">Physician ID</label>
                        <input type="text" formControlName="employeeId" class="form-control" [value]="employeeId">
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col col-md-8">
                        <label for="patient" class="form-label">Patient Name</label>
                        <select formControlName="patient" class="form-control"
                            (change)="getAvailabilityWindows(); showPatientId();" [(ngModel)]="appointment.patientEmail">
                            <option value="">Select Patient</option>
                            <option *ngFor="let p of patients" [value]="p.email">{{p.name}}</option>
                        </select>
                        <small *ngIf="appointmentForm.controls['patient'].touched && appointmentForm.controls['patient'].invalid"
                            class="text-danger">Patient cannot be empty</small>
                    </div>
                    <div class="col col-md-4">
                        <label for="employeeId" class="form-label">Patient ID</label>
                        <input type="text" formControlName="patientId" class="form-control" [value]="patientId">
                    </div>
                </div>
        
                <div class="mb-4">
                    <label for="aptDate" class="form-label">Date of Appointment</label>
                    <input type="date" formControlName="aptDate" class="form-control" [min]="today" [max]="next3months"
                        (change)="getAvailabilityWindows()" [(ngModel)]="appointment.aptDate">
                </div>
        
                <div class="mb-4" >
                    <label for="window" class="form-label">Availability Window</label>
                    <select class="form-control" formControlName="window" (change)="populateTimes()" >
                        <option *ngIf="windows.length == 0" [value]="-1">No Window Available</option>
                        <option *ngIf="windows.length > 0" [value]="-1">Select Window</option>
                        <option *ngFor="let w of windows; let i=index;" [value]="i">{{w.label}}</option>
                    </select>
                    <small *ngIf="appointmentForm.controls.window.touched && appointmentForm.controls.window.value == -1" class="text-danger">
                        Availability window is required</small>
                </div>
        
                <div class="row mb-4" *ngIf="windows.length > 0 ">
                    <div class="col col-md-6">
                        <label for="startsAt" class="form-label">Start Time</label>
                        <select formControlName="startsAt" class="form-control" (change)="updateEndTimes()">
                            <option *ngIf="startTimes.length > 0" [value]="-1">Select Start Time</option>
                            <option *ngFor="let st of startTimes; let i=index;" [value]="i">{{st | uppercase}}</option>
                        </select>
                    </div>
                    <div class="col col-md-6">
                        <label for="endsAt" class="form-label">End Time</label>
                        <select formControlName="endsAt" class="form-control" >
                            <option *ngIf="endTimes.length == 0" [value]="-1">Select End Time</option>
                            <option *ngFor="let et of endTimes; let i=index;" [value]="i">{{et | uppercase}}</option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="editHistory" class="form-label">Edit History</label>
                    <input type="text" class="form-control" formControlName="editHistory" id="editHistory" readonly="readonly" >
                </div>
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-success mb-2" (click)="editAppointment()">Edit</button>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger mb-2" (click)="deleteAppointment()">Delete</button>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-warning mb-2" (click)="close()">Close</button>
                    </div>
                </div>
            </form>
        </mat-card>
    </mat-tab>
    <mat-tab label="Patient Details">
        <mat-card class="example-card">
            <mat-card-content>
                <form autofocus="off" [formGroup]="patientDetailsForm">
                    <mat-card-content>
                        <h3><b>Personal Details</b></h3>
                        <div>
                            <div class="mb-3">
                                <label for="firstName" class="form-label">FirstName</label>
                                <input type="text" formControlName="firstName" class="form-control" id="firstName"
                                    [(ngModel)]="patient.firstName">
                                <div *ngIf="patientDetailsForm.controls['firstName'].touched && patientDetailsForm.controls['firstName'].invalid"
                                    class="alert text-danger">
                                    {{errorMessage}}
                                    <div *ngIf="patientDetailsForm.controls['firstName'].errors?.['required']">FirstName
                                        cannot
                                        be
                                        blank
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="lastName" class="form-label">LastName</label>
                                <input type="text" formControlName="lastName" class="form-control" id="lastName"
                                    [(ngModel)]="patient.lastName">
                                <div *ngIf="patientDetailsForm.controls['lastName'].touched && patientDetailsForm.controls['lastName'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['lastName'].errors?.['required']">LastName
                                        cannot
                                        be
                                        blank</div>
                                    <!-- <div *ngIf="vitalDetailsForm.controls['weight'].errors?.pattern">Invalid weight cannot be
                                        blank</div> -->

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" formControlName="email" class="form-control" id="email"
                                    [(ngModel)]="patient.email">
                                <div *ngIf="patientDetailsForm.controls['email'].touched && patientDetailsForm.controls['email'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['email'].errors?.['required']">Email
                                        cannot be blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="dob" class="form-label">Date Of Birth</label>
                                <input type="date" formControlName="dob" class="form-control" id="dob"
                                    [(ngModel)]="patient.birthdate">
                                <div *ngIf="patientDetailsForm.controls['dob'].touched && patientDetailsForm.controls['dob'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['dob'].errors?.['required']">Date Of Birth
                                        cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="phone" class="form-label">Phone No</label>
                                <input type="text" formControlName="phone" class="form-control" id="phone"
                                    [(ngModel)]="patient.phone">
                                <div *ngIf="patientDetailsForm.controls['phone'].touched && patientDetailsForm.controls['phone'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['phone'].errors?.['required']">
                                        Phone No cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="age" class="form-label">Age</label>
                                <input type="text" formControlName="age" class="form-control" id="age"
                                    [(ngModel)]="demographics.age">
                                <div *ngIf="patientDetailsForm.controls['age'].touched && patientDetailsForm.controls['age'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['age'].errors?.['required']">
                                        Age cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="gender" class="form-label">Gender</label>
                                <input type="text" formControlName="gender" class="form-control" id="gender"
                                    [(ngModel)]="demographics.gender">
                                <div *ngIf="patientDetailsForm.controls['gender'].touched && patientDetailsForm.controls['gender'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['gender'].errors?.['required']">
                                        Gender cannot be
                                        blank</div>

                                </div>
                            </div>
                            <h3><b>Demographic Details</b></h3>
                            <div class="mb-3">
                                <label for="race" class="form-label">Race</label>
                                <input type="text" formControlName="race" class="form-control" id="race"
                                    [(ngModel)]="demographics.race">
                                <div *ngIf="patientDetailsForm.controls['race'].touched && patientDetailsForm.controls['race'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['race'].errors?.['required']">
                                        Race cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="ethnicity" class="form-label">Ethnicity</label>
                                <input type="text" formControlName="ethnicity" class="form-control" id="ethnicity"
                                    [(ngModel)]="demographics.ethnicity">
                                <div *ngIf="patientDetailsForm.controls['ethnicity'].touched && patientDetailsForm.controls['ethnicity'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['ethnicity'].errors?.['required']">
                                        Ethnicity cannot be
                                        blank</div>

                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="language" class="form-label">Language</label>
                                <input type="text" formControlName="language" class="form-control" id="language"
                                    [(ngModel)]="demographics.language">
                                <div *ngIf="patientDetailsForm.controls['language'].touched && patientDetailsForm.controls['language'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['language'].errors?.['required']">
                                        Language cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="address" class="form-label">Address</label>
                                <textarea type="text" formControlName="address" class="form-control" id="address"
                                    [(ngModel)]="demographics.address"></textarea>
                                <div *ngIf="patientDetailsForm.controls['address'].touched && patientDetailsForm.controls['address'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['address'].errors?.['required']">
                                        Address cannot be
                                        blank</div>

                                </div>
                            </div>
                            <h3><b>Nominee Details</b></h3>
                            <div class="mb-3">
                                <label for="nomineeFirstName" class="form-label">FirstName</label>
                                <input type="text" formControlName="nomineeFirstName" class="form-control"
                                    id="nomineeFirstName" [(ngModel)]="nominee.firstName">
                                <div *ngIf="patientDetailsForm.controls['nomineeFirstName'].touched && patientDetailsForm.controls['nomineeFirstName'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['nomineeFirstName'].errors?.['required']">
                                        FirstName cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="nomineeLastName" class="form-label">LastName</label>
                                <input type="text" formControlName="nomineeLastName" class="form-control"
                                    id="nomineeLastName" [(ngModel)]="nominee.lastName">
                                <div *ngIf="patientDetailsForm.controls['nomineeLastName'].touched && patientDetailsForm.controls['nomineeLastName'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['nomineeLastName'].errors?.['required']">
                                        LastName cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="nomineeEmail" class="form-label">Email</label>
                                <input type="text" formControlName="nomineeEmail" class="form-control" id="nomineeEmail"
                                    [(ngModel)]="nominee.email">
                                <div *ngIf="patientDetailsForm.controls['nomineeEmail'].touched && patientDetailsForm.controls['nomineeEmail'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['nomineeEmail'].errors?.['required']">
                                        Email cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="nomineePhone" class="form-label">Phone</label>
                                <input type="text" formControlName="nomineePhone" class="form-control" id="nomineePhone"
                                    [(ngModel)]="nominee.phone">
                                <div *ngIf="patientDetailsForm.controls['nomineePhone'].touched && patientDetailsForm.controls['nomineePhone'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['nomineePhone'].errors?.['required']">
                                        Phone cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="relation" class="form-label">Relation</label>
                                <input type="text" formControlName="relation" class="form-control" id="relation"
                                    [(ngModel)]="nominee.relation">
                                <div *ngIf="patientDetailsForm.controls['relation'].touched && patientDetailsForm.controls['relation'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['relation'].errors?.['required']">
                                        Relation cannot be
                                        blank</div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="nomineeAddress" class="form-label">Address</label>
                                <textarea type="text" formControlName="nomineeAddress" class="form-control"
                                    id="nomineeAddress" [(ngModel)]="nominee.address"></textarea>
                                <div *ngIf="patientDetailsForm.controls['nomineeAddress'].touched && patientDetailsForm.controls['nomineeAddress'].invalid"
                                    class="alert text-danger">
                                    <div *ngIf="patientDetailsForm.controls['nomineeAddress'].errors?.['required']">
                                        Address cannot be
                                        blank</div>

                                </div>
                            </div>
                        </div>
                    </mat-card-content>
                    <div class="row">
                        
                        <div class="col-md-2" *ngIf="result.vitalId!=0">
                            <button type="button" class="btn btn-success mb-2"
                                (click)="editPatientDetails()">Edit</button>
                        </div>

                        <div class="col-md-2">
                            <button type="button" class="btn btn-warning mb-2" (click)="close()">Close</button>
                        </div>
                    </div>
                </form>

            </mat-card-content>

        </mat-card>
    </mat-tab>
    <mat-tab label="Vital Sign Details">
        <mat-card class="example-card">
            <form autofocus="off" [formGroup]="vitalDetailsForm">
                <mat-card-content>
                    <div>
                        <div class="mb-3">
                            <label for="height" class="form-label">Height in cm</label>
                            <input type="number" formControlName="height" class="form-control" id="height" min="1"
                                max="250" [(ngModel)]="result.height" (blur)="validateHeight()">
                            <div *ngIf="vitalDetailsForm.controls['height'].touched && vitalDetailsForm.controls['height'].invalid"
                                class="alert text-danger">
                                {{errorMessage}}
                                <div *ngIf="vitalDetailsForm.controls['height'].errors?.['required']">Height cannot be
                                    blank
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Weight in Kg</label>
                            <input type="text" formControlName="weight" class="form-control" id="weight"
                                [(ngModel)]="result.weight">
                            <div *ngIf="vitalDetailsForm.controls['weight'].touched && vitalDetailsForm.controls['weight'].invalid"
                                class="alert text-danger">
                                <div *ngIf="vitalDetailsForm.controls['weight'].errors?.['required']">weight cannot be
                                    blank</div>
                                <div *ngIf="vitalDetailsForm.controls['weight'].errors?.pattern">Enter Valid Weight
                                    e.g.66.15</div>

                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="bloodPressure" class="form-label">Blood Pressure in mm Hg</label>
                            <input type="text" formControlName="bloodPressure" class="form-control" id="bloodPressure"
                                [(ngModel)]="result.bloodPressure">
                            <div *ngIf="vitalDetailsForm.controls['bloodPressure'].touched && vitalDetailsForm.controls['bloodPressure'].invalid"
                                class="alert text-danger">
                                <div *ngIf="vitalDetailsForm.controls['bloodPressure'].errors?.['required']">Blood
                                    Pressure cannot be blank</div>

                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="bodyTemperature" class="form-label">Body Temperature in Fahrenheit</label>
                            <input type="text" formControlName="bodyTemperature" class="form-control"
                                id="bodyTemperature" [(ngModel)]="result.bodyTemperature">
                            <div *ngIf="vitalDetailsForm.controls['bodyTemperature'].touched && vitalDetailsForm.controls['bodyTemperature'].invalid"
                                class="alert text-danger">
                                <div *ngIf="vitalDetailsForm.controls['bodyTemperature'].errors?.['required']">Body
                                    Temperature cannot be
                                    blank</div>

                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="respirationRate" class="form-label">Respiration Rate in BPM</label>
                            <input type="text" formControlName="respirationRate" class="form-control"
                                id="respirationRate" [(ngModel)]="result.respirationRate">
                            <div *ngIf="vitalDetailsForm.controls['respirationRate'].touched && vitalDetailsForm.controls['respirationRate'].invalid"
                                class="alert text-danger">
                                <div *ngIf="vitalDetailsForm.controls['respirationRate'].errors?.['required']">
                                    Respiration Rate cannot be
                                    blank</div>

                            </div>
                        </div>
                    </div>
                </mat-card-content>
                <div class="row">
                    
                    <div class="col-md-2" *ngIf="result.vitalId!=0">
                        <button type="button" class="btn btn-success mb-2" (click)="editVitalSigns()">Save</button>
                    </div>
                    <div class="col-md-2" *ngIf="result.vitalId!=0">
                        <button type="button" class="btn btn-danger mb-2" (click)="deleteVitalDetails()">Delete</button>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-warning mb-2" (click)="close()">Close</button>
                    </div>
                </div>
            </form>
        </mat-card>
    </mat-tab>
</mat-tab-group>